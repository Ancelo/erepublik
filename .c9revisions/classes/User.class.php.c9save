{"ts":1357327049303,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"<?php \r\nif (!class_exists(\"User\")) {\r\nclass User\r\n{\r\n\tpublic $id;\r\n\tprivate $qRows=array('uid','nick','email','date','status','pass','maxhp','currenthp','country','gold','money','xp');\r\n\t\r\n\t\r\n\tfunction __construct($id=false)\r\n\t{\r\n\t\tif($id){\r\n\t\t\t$this->id=(int)$id;\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic static function infoUser($id)\r\n\t{\r\n\t\t$id=(int)$id;\r\n\t\t$query=\"SELECT * FROM users WHERE uid='\".$id.\"' \";\r\n\t\t$result=mysql_query($query,$GLOBALS['db_slave']);\r\n\t\tif(mysql_num_rows($result)<1){ return false;}\r\n\t\t\r\n\t\treturn mysql_fetch_array($result);\r\n\t}\r\n\t\r\n\tpublic function newUser($array)\r\n\t{\r\n\t\t$array['nick']=mysql_real_escape_string($array['nick']);\r\n\t\t$array['email']=mysql_real_escape_string($array['email']);\r\n\t\t//$time=time();\r\n\t\r\n\t\t$arr=array(\r\n\t\t\t'uid'=>'',\r\n\t\t\t'status'=>2,\r\n\t\t\t'date'=>time(),\r\n\t\t\t'maxhp'=>100,\r\n\t\t\t'currenthp'=>100,\r\n\t\t\t'gold'=>0,\r\n\t\t\t'money'=>150,\r\n\t\t\t'xp'=>0,\r\n\t\t);\r\n\t\t$array=array_merge($array,$arr);\r\n\t\t\r\n\t\t\r\n\t\t$sql_query=\"SELECT nick FROM users WHERE nick='\".$array['nick'].\"' OR email='\".$array['email'].\"'\";\r\n\t\t$result=mysql_query($sql_query,$GLOBALS['db_slave']);\r\n\t\tif(mysql_num_rows($result)>0){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\t$array['pass']=encripta($array['pass']);\r\n\t\t$qSet=$this->parseUser($array);\r\n\t\t\r\n\t\tif(!$qSet){return false;}\r\n\t\t\r\n\t\t$query=\"INSERT INTO users SET \".$qSet;\r\n\t\t$result=mysql_query($query,$GLOBALS['db']);\r\n\t\t$done=mysql_affected_rows();\r\n\t\tif($done>0){\r\n\t\t\treturn true;\t\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tprivate function parseUser($array=false)\r\n\t{\r\n\t\t$qSet=\"\";\r\n\t\tforeach($this->qRows as $row)\r\n\t\t{\t\r\n\t\t\tif(!$array){\r\n\t\t\t\t$content=mysql_real_escape_string(strip_tags($this->$row));\r\n\t\t\t}else{\r\n\t\t\t\t$content=mysql_real_escape_string(strip_tags($array[$row]));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif($content=='' && ($array && $row!='uid') || !isset($content)){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t$qSet.=$row.\"='\".$content.\"',\";\r\n\t\t}\r\n\t\t$qSet=substr($qSet,0,-1);\r\n\t\treturn $qSet;\r\n\t}\r\n\t\r\n\tpublic function saveUser()\r\n\t{\r\n\t\t$qSet=$this->parseUser();\r\n\t\t\r\n\t\t$query=\"UPDATE users SET \".$qSet.\" WHERE uid='\".$this->uid.\"'\";\r\n\t\t$result=mysql_query($query,$GLOBALS['db']);\r\n\t}\r\n}}\r\n\r\n\r\n?>"]],"start1":0,"start2":0,"length1":0,"length2":2097}]],"length":2097}
